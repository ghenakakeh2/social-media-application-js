<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- import bootstrap -->
    <!-- <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- import axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- <script src="./node_modules/axios/dist/axios.min.js"></script>
    <script src="./node_modules/axios/dist/axios.js"></script> -->
    <title>Document</title>
    <style>
        body{
            background-color: #f0ecff;
            height: 1500px;
           
        }
        .card{
          margin-top: 30px;
        }
    
        .r{
          border: 1px solid red;
          
        }
    </style>
</head>

<body>
     <!-- ********modales************ -->
  <!-- login modal -->
  <div class="modal fade" id="Login-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Login</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">user name</label>
              <input type="text" class="form-control" id="user-name" value="ghena">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">password</label>
              <input type="password"class="form-control" id="password-text" value="123456"></input>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="loginbuttonclicked()" id="loginbtn">Login</button>
        </div>
      </div>
    </div>
  </div>
  <!-- register modal -->
  <div class="modal fade" id="register-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Register A New User</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">name</label>
              <input type="text" class="form-control" id="register-name" value="ghena">
            </div>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">user name</label>
              <input type="text" class="form-control" id="register-user-name" value="ghena">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">password</label>
              <input type="password"class="form-control" id="register-password" value="123456"></input>
            </div>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">your Personal Photo</label>
              <input type="file" class="form-control" id="personalImage-register-input" >
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="registerbuttonclicked()" id="loginbtn">Register</button>
        </div>
      </div>
    </div>
  </div>
 <!-- ***************Alerts***************** -->
  <!-- success login alert -->
 
  <div id="successAlert" class="show fade w-25 " style="position: absolute; bottom: 5%;right: 0; z-index: 1000;"></div>
  

   <!-- start navgation bar container -->
   <div class="container  p-0 ">
    <div class="d-flex justify-content-center bg-none">
        <div class="col-9">
            <nav class="navbar navbar-expand-lg bg-light pt-3 shadow rounded ">
                <div class="container-fluid">
                  <a class="navbar-brand" href="home.html">Tarmeez</a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                      <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#">Portfilo</a>
                      </li>
                    </ul>
                   <div class="d-flex  justify-content-end me-3">
                     <!-- none logged in user  -->
                     <button type="button" class="btn btn-outline-success mx-3" data-bs-toggle="modal" data-bs-target="#Login-modal" id="loginbutton">Login</button>
                     <button type="button" class="btn btn-outline-success" id="registerbtn"  data-bs-toggle="modal" data-bs-target="#register-modal">Register</button>
                     <!-- logged in user -->
                     <div id="log-out-div" class=" d-flex justify-content-end w-100 align-items-center">
                       <img src="" alt="" style="width: 50px; height: 50px;" class="rounded-circle me-3" id="user-profile-image">
                        <span class="me-3 " style="font-size: 20px;" id="username-nav">ddddd</span>
                       <button type="button" class="btn btn-outline-danger me-4" id="logoutbtn" onclick="Logout()">log out</button>
                     </div>
                   </div>

                       
                  </div>
                </div>
              </nav>
        </div>
    </div>
</div>
 <!-- start main cintent -->
 <div class="container " style="height: 1000px;">
    <div class="row d-flex justify-content-center mt-5">
        <div class="col-9">
            <span id="user-name-post-page">
                
            </span>


            post
        </div>

    </div>
    <div class="d-flex justify-content-center bg-none mt-5">
      <div class="col-9">
        <!--  start posts -->
        <div class="posts" id="postsPage">
            
                <div class="card shadow" " id=${post.id}>
                         <div class="card-header">
                           <img src=${post.author.profile_image} alt="" style="width: 50px ; height: 50px;" class="rounded-circle border border-3">
                           <b > ${post.author.username}</b>
                         </div>
                         <div class="card-body p-0" style="cursor: pointer;">
                           <img src=${post.image} alt="" style="width: 100%; height: 400px;">
                         <div class=" p-3">
                       <h6 class="text-secondary mt-1 ">${post.created_at}</h6>
                       <h5 class="">${postTitle}</h5>
                       <p class="">${post.body}</p>
                       <hr>
                         <div class="">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
                                 <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z"/>
                         </svg>
                         <span class="ms-2">${post.comments_count}</span>
                            <span class="ms-2" id="post-tages-${post.id}"></span>
                        </div>
                        <div class="comments">
                            comments
                            </div>
                        </div>
                        </div>
                        <div class="comments p-3 " style="background-color: rgb(210, 206, 206);">
                            <!-- user image + profile -->
                           <div id="comments">
                           <div id="">
                            <div>
                                <img src="./image/user image.jpg" alt="" class="rounded-circle" style="width: 40px;height: 40px;">
                                <b>ghena</b>
                            </div>
                            <!-- comment body -->
                            <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro, dolorem necessitatibus maxime, placeat accusamus itaque rem officiis ab accusantium numquam, ad quidem explicabo voluptate perspiciatis cupiditate beatae? Quo, mollitia dicta.</div>
                           </div>

                           <div id="">
                            <div>
                                <img src="./image/user image.jpg" alt="" class="rounded-circle" style="width: 40px;height: 40px;">
                                <b>ghena</b>
                            </div>
                            <!-- comment body -->
                            <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro, dolorem necessitatibus maxime, placeat accusamus itaque rem officiis ab accusantium numquam, ad quidem explicabo voluptate perspiciatis cupiditate beatae? Quo, mollitia dicta.</div>
                           </div>



                           <div id="">
                            <div>
                                <img src="./image/user image.jpg" alt="" class="rounded-circle" style="width: 40px;height: 40px;">
                                <b>ghena</b>
                            </div>
                            <!-- comment body -->
                            <div>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro, dolorem necessitatibus maxime, placeat accusamus itaque rem officiis ab accusantium numquam, ad quidem explicabo voluptate perspiciatis cupiditate beatae? Quo, mollitia dicta.</div>
                           </div>
                           </div>

                        </div>
                        <div id="add-comment ">
                         <input type="text" style="width: 90%;" class="p-2"> 
                         <button style="width: 9.5%; border: 1px solid blue;color: blue;" class="btn p-2 m-0"bac>send</button>
                        </div>
                       </div>
            

        </div>
        <!--  end posts -->
        </div>
     </div>

  </div>









    <script src="./script.js"></script>
    <script>
        // get the post selected
        const  urlParams=new URLSearchParams(window.location.search);
        const id=urlParams.get("postId");
       function getpost(){
        
        axios.get(`${path}posts/${id}`)
      .then(function (response) {
        let postTitle=" ";

      let card =''
    const post=response.data.data;
    const postComments=post.comments;
    document.getElementById("user-name-post-page").innerHTML= post.author.username +"     ";
     if(post.title!=null){
          postTitle=post.title;
        }
        let contentComment=""
        for(comment of post.comments){
            contentComment+=`
            <div style="background-color: rgb(210, 206, 206); " class="mb-2" >
                            <div >
                                <img src=${comment.author.profile_image}alt="" class="rounded-circle" style="width: 40px;height: 40px;">
                                <b>${comment.author.name}</b>
                            </div>
                            <!-- comment body -->
                            <div>${comment.body}</div>
                           </div>
            `
        }
    card =`
        <div class="card shadow" " id=${post.id}>
                <div class="card-header">
                  <img src=${post.author.profile_image} alt="" style="width: 50px ; height: 50px;" class="rounded-circle border border-3">
                  <b > ${post.author.username}</b>
                </div>
                <div class="card-body p-0" style="curser:pointer;">
                  <img src=${post.image} alt="" style="width: 100%; height: 400px;">
                <div class=" p-3">
                <h6 class="text-secondary mt-1 ">${post.created_at}</h6>
                <h5 class="">${postTitle}</h5>
                <p class="">${post.body}</p>
                <hr>
                 <div class="">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
                          <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z"/>
                     </svg>
                    <span class="ms-2">${post.comments_count}</span>
                    <span class="ms-2" id="post-tages-${post.id}"></span>
                 </div>
                 <div class="comments p-3 ">
                 <div id="comments">
                    ${contentComment}
                     </div>
                 </div>
                </div>
            </div>
            <div id="add-comment" class="input-group">
                         <input type="text" style="" class="form-control" id="comment-input" placeholder="add your comment here ..."> 
                         <button style=" " class="btn btn-outline-primary " onclick="addNewComment()">send</button>
                        </div>
        </div>
        `
        document.getElementById("postsPage").innerHTML=card;
    console.log(response)
  })
       }
getpost()
  setupui()

//   add new comment 
function addNewComment(){
    const newComment=document.getElementById("comment-input").value;
    const token=localStorage.getItem("token")
    const param={
        body:newComment
    }
    const headers={
        "Authorization":`Bearer ${token}`
    }
    axios.post(`${path}posts/${id}/comments`,param,{
    headers:headers
  })
  .then(function (response) {
    console.log(response)
    getpost();
    alert("comment added successfully","success")

  }).catch((e) => {
    const massage=e.response.data.message;
    alert(massage,"danger")

    console.log(e.response.data.message)
  }
  )

}



    </script>
</body>
</html>